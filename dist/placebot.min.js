!function(exports){"use strict";var place=r.place,api;r.placeModule("",function(t){api=t("api")});var PlaceBot=function(){this.placeMode=PlaceBot.placeMode.ARRAY,this.tiles=[],this.tileSelector=PlaceBot.selector.TopDown,this._tileGeneratorFactory=void 0,this.tileGenerator=void 0,this.drawTimer=void 0,this.minTimer=100,this.lastDrawTime=0,console.log(["------------",,"PlaceBot "+PlaceBot.version,"------------"].join("\n")),this.load(),this._setTimer()};Object.defineProperties(PlaceBot.prototype,{cooldownRemaining:{get:function(){return this.nextDrawTime-Date.now()}},nextDrawTime:{get:function(){return place.cooldownEndTime}},canDraw:{get:function(){return this.cooldownRemaining<0&&this.lastDrawTime!==this.nextDrawTime}}}),PlaceBot.prototype._importObject=function(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(t){return{success:!1,error:t.message}}return{success:!0,data:t}},PlaceBot.prototype._importFunction=function(data){if("string"==typeof data)try{data=eval("("+data+")")}catch(t){return{success:!1,error:t.message}}return"function"!=typeof data?{success:!1,error:"Invalid data type"}:{success:!0,data:data}},PlaceBot.prototype._tilesObject=function(){var t={mode:this.placeMode,tiles:this.tiles};return this.placeMode===PlaceBot.placeMode.ARRAY?t.fn=this.tileSelector.name:this.placeMode===PlaceBot.placeMode.FUNCTION&&(t.fn=this._tileGeneratorFactory.toString()),t},PlaceBot.prototype._settingsObject=function(){return{minTimer:this.minTimer}},PlaceBot.prototype.exportTiles=function(){return JSON.stringify(this._tilesObject())},PlaceBot.prototype.importTiles=function(t){var e=this._importObject(t);if(!e.success)return console.log("Failed to import tiles: %s",e.error),!1;var o=Object.assign(this._tilesObject(),e.data);this.tiles=o.tiles||[],this.setTileFunction(o.mode,o.fn)},PlaceBot.prototype.exportSettings=function(){return JSON.stringify(this._settingsObject())},PlaceBot.prototype.importSettings=function(t){var e=this._importObject(t);if(!e.success)return console.log("Failed to import settings: %s",e.error),!1;var o=Object.assign(this._settingsObject(),e.data);this.tileSelector=PlaceBot.selector[o.tileSelector]||PlaceBot.selector.TopDown,this.minTimer=o.minTimer},PlaceBot.prototype.exportBot=function(){return JSON.stringify({settings:this._settingsObject(),tiles:this.tiles})},PlaceBot.prototype.importBot=function(t){var e=this._importObject(t);if(!e.success)return console.log("Failed to import bot: %s",e.error),!1;this.importSettings(e.data.settings),this.importTiles(e.data.tiles)},PlaceBot.prototype.save=function(){localStorage.setItem("placebot_settings",this.exportSettings()),localStorage.setItem("placebot_tiles",this.exportTiles())},PlaceBot.prototype.load=function(){this.importSettings(localStorage.getItem("placebot_settings")),this.importTiles(localStorage.getItem("placebot_tiles"))},PlaceBot.prototype.setTileFunction=function(t,e){var o;switch(t){case PlaceBot.placeMode.ARRAY:this.placeMode=PlaceBot.placeMode.ARRAY,this.tileGenerator=void 0,"string"==typeof e&&PlaceBot.selector.hasOwnProperty(e)?this.tileSelector=PlaceBot.selector[e]:(o=this._importFunction(e),o.success?this.tileSelector=o.data:this.tileSelector=PlaceBot.selector.TopDown);break;case PlaceBot.placeMode.FUNCTION:if(this.placeMode=PlaceBot.placeMode.FUNCTION,this.tileSelector=void 0,o=this._importFunction(e),o.success){this._tileGeneratorFactory=o.data,this.tileGenerator=o.data(this);break}console.log("Function import failed: %s",o.error);default:this.tiles=[],this.setTileFunction(PlaceBot.placeMode.ARRAY,"TopDown")}},PlaceBot.prototype._setTimer=function(){clearTimeout(this.drawTimer);var t=Math.round(Math.max(this.minTimer,this.cooldownRemaining));this.drawTimer=setTimeout(this.drawNext.bind(this),t),console.log("Scheduled draw in %sms",t)},PlaceBot.prototype.drawNext=function(){if(this.canDraw){var t;if(this.placeMode===PlaceBot.placeMode.ARRAY){if(this.tiles.length){var e=this.tileSelector(this.tiles);t=this.tiles.splice(e,1)[0]}}else this.placeMode===PlaceBot.placeMode.FUNCTION&&(t=this.tileGenerator());t&&(api.getPixelInfo(t[0],t[1]).then(function(e){e.color!==t[2]&&this.drawTile.apply(this,t),this._setTimer()}.bind(this)),this.save())}this._setTimer()},PlaceBot.prototype.drawTile=function(t,e,o){this.canDraw&&(this.lastDrawTime=this.nextDrawTime,place.setColor(o),place.drawTile(t,e),console.log("Drawing %s at (%s, %s)",place.palette[o],t,e))},PlaceBot.version="0.0.6",PlaceBot.placeMode={ARRAY:0,FUNCTION:1},PlaceBot.selector={TopDown:function(t){var e=-1,o=1/0,i=1/0;return t.forEach(function(t,s){(t[1]<i||t[1]===i&&t[0]<o)&&(e=s,o=t[0],i=t[1])}),e},BottomUp:function(t){var e=-1,o=-1,i=-1;return t.forEach(function(t,s){(t[1]>i||t[1]===i&&t[0]>o)&&(e=s,o=t[0],i=t[1])}),e},Random:function(t){return Math.floor(Math.random()*t.length)},DrawOrder:function(t){return 0}},exports.PlaceBot=PlaceBot,exports.placeBot=new PlaceBot}("undefined"!=typeof unsafeWindow?unsafeWindow:"undefined"!=typeof window?window:{});